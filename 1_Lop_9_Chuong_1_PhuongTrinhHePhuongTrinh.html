<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra Toán 9</title>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['\\(', '\\)']], displayMath: [['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root { --bg: #073b3a; --chalk: #fff; --gold: #f1c40f; --green: #27ae60; --red: #c0392b; }
        body { background: var(--bg); color: var(--chalk); font-family: 'Segoe UI', sans-serif; font-size: 150%; margin: 0; display: flex; justify-content: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .app { width: 100%; max-width: 600px; background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); }
        .header { color: var(--gold); text-align: center; font-weight: bold; text-transform: uppercase; margin-bottom: 20px; border-bottom: 2px dashed rgba(255,255,255,0.2); padding-bottom: 10px; font-size: 1.2rem; }
        .screen { display: none; animation: fadeIn 0.4s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        input { width: 100%; padding: 15px; margin: 10px 0; font-size: 1.2rem; border-radius: 10px; border: none; box-sizing: border-box; }
        .option-btn { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.3); color: #fff; padding: 15px; margin-bottom: 10px; width: 100%; text-align: left; border-radius: 12px; cursor: pointer; font-size: 1.1rem; transition: 0.3s; display: flex; align-items: center; }
        .option-btn:hover { background: rgba(241, 196, 15, 0.2); border-color: var(--gold); transform: scale(1.02); }
        .correct { background: var(--green) !important; border-color: #fff; }
        .wrong { background: var(--red) !important; border-color: #fff; }
        .btn-main { background: var(--gold); color: #000; border: none; padding: 18px; font-weight: bold; border-radius: 15px; cursor: pointer; width: 100%; font-size: 1.2rem; }
        .progress { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: var(--gold); width: 0%; transition: 0.3s; }
    </style>
</head>
<body>

<div class="app">
    <div class="header">BÀI TẬP TRẮC NGHIỆM CUỐI CHƯƠNG 1</div>

    <div id="info-screen" class="screen active">
        <input type="text" id="stuName" placeholder="Họ và tên học sinh">
        <input type="text" id="stuClass" placeholder="Lớp">
        <button class="btn-main" onclick="start()">BẮT ĐẦU</button>
    </div>

    <div id="quiz-screen" class="screen">
        <div class="progress"><div id="progress-fill" class="progress-fill"></div></div>
        <div id="q-text" style="margin-bottom:20px; font-weight: bold;"></div>
        <div id="options"></div>
    </div>

    <div id="result-screen" class="screen" style="text-align: center;">
        <div id="res-content"></div>
        <button class="btn-main" onclick="restart()">LÀM LẠI TOÀN BÀI</button>
        <p id="retry-info" style="font-size: 0.8rem; margin-top: 15px;"></p>
    </div>
</div>

<audio id="s-correct" src="https://www.soundjay.com/buttons/sounds/button-11.mp3"></audio>
<audio id="s-wrong" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>

<script>
    // THAY LINK SCRIPT CỦA BẠN VÀO ĐÂY
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzNP9h1c_8ZYf3-iLdQMk5Hl702bTFKHVFv1hVaZHSElepn553188fvmXjTRRvKJDzBow/exec"; 

    const questions = [
        { q: "Tất cả các nghiệm của phương trình \\((x + 3)(2x - 6) = 0\\) là", options: ["\\(x = -3\\).", "\\(x = 3\\).", "\\(x = 3 \\text{ và } x = -3\\).", "\\(x = 2\\)."], correct: 2 },
        { q: "Điều kiện xác định của phương trình \\(\\frac{2x+3}{x-4} + 2 = \\frac{1}{x-3}\\) là", options: ["\\(x \\neq 4\\).", "\\(x \\neq 3\\).", "\\(x \\neq 4 \\text{ và } x \\neq 3\\).", "\\(x = 4 \\text{ và } x = 3\\)."], correct: 2 },
        { q: "Nghiệm của phương trình \\(\\frac{x+2}{x-4} - 1 = \\frac{30}{(x+3)(x-4)}\\) là", options: ["\\(x = 2\\).", "\\(x = -3\\).", "\\(x = 4\\).", "\\(x = -2\\)."], correct: 0 },
        { q: "Phương trình nào sau đây **không phải** là phương trình bậc nhất hai ẩn?", options: ["\\(5x - y = 3\\).", "\\(\\sqrt{5}x + 0y = 0\\).", "\\(0x - 4y = \\sqrt{6}\\).", "\\(0x + 0y = 12\\)."], correct: 3 },
        { q: "Đường thẳng biểu diễn tất cả các nghiệm của phương trình \\(3x - y = 2\\)", options: ["Vuông góc với trục tung.", "Vuông góc với trục hoành.", "Đi qua gốc tọa độ.", "Đi qua điểm \\(A(1; 1)\\)."], correct: 3 },
        { q: "Cặp số \\((-2; -3)\\) là nghiệm của hệ phương trình nào sau đây?", options: ["\\(\\begin{cases} x-2y=3 \\\\ 2x+y=4 \\end{cases}\\)", "\\(\\begin{cases} 2x-y=-1 \\\\ x-3y=8 \\end{cases}\\)", "\\(\\begin{cases} 2x-y=-1 \\\\ x-3y=7 \\end{cases}\\)", "\\(\\begin{cases} 4x-2y=0 \\\\ x-3y=5 \\end{cases}\\)"], correct: 2 }
    ];

    let current = 0, score = 0, retries = 0, startTime;

    function start() {
        if(!document.getElementById('stuName').value || !document.getElementById('stuClass').value) return alert("Nhập đủ thông tin em nhé!");
        startTime = new Date().toLocaleString('vi-VN');
        show('quiz-screen');
        render();
    }

    function render() {
        const q = questions[current];
        document.getElementById('progress-fill').style.width = (current / questions.length * 100) + "%";
        document.getElementById('q-text').innerHTML = `Câu ${current + 1}: ${q.q}`;
        const box = document.getElementById('options');
        box.innerHTML = '';
        q.options.forEach((t, i) => {
            const b = document.createElement('button');
            b.className = 'option-btn';
            b.innerHTML = `<strong>${String.fromCharCode(65+i)}.</strong> &nbsp; ${t}`;
            b.onclick = () => select(i, b);
            box.appendChild(b);
        });
        MathJax.typesetPromise();
    }

    function select(idx, btn) {
        const correct = questions[current].correct;
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.style.pointerEvents = 'none');
        if(idx === correct) {
            btn.classList.add('correct');
            document.getElementById('s-correct').play();
            score++;
        } else {
            btn.classList.add('wrong');
            btns[correct].classList.add('correct');
            document.getElementById('s-wrong').play();
        }
        setTimeout(() => {
            current++;
            if(current < questions.length) render();
            else finish();
        }, 1200);
    }

    function finish() {
        show('result-screen');
        // Ép kiểu số để Google Sheets không hiểu nhầm là chữ
        let finalScore = Math.round((score / questions.length) * 10 * 10) / 10;
        
        document.getElementById('res-content').innerHTML = `
            <h2 style="font-size: 2.5rem; color: var(--gold);">${finalScore} ĐIỂM</h2>
            <p>Em làm tốt lắm. Cô đã nhận được bài của em</p>
        `;
        document.getElementById('retry-info').innerText = `Số lần làm lại: ${retries}`;

        // Gửi dữ liệu (Dùng Try/Catch để tránh bị đứng nếu link hỏng)
        try {
            const data = {
                name: document.getElementById('stuName').value,
                class: document.getElementById('stuClass').value,
                score: finalScore,
                retries: retries,
                time: startTime
            };
            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
            .catch(e => console.log("Lỗi gửi Sheet nhưng không sao, học sinh vẫn thấy điểm."));
        } catch (e) {
            console.log("Lỗi hệ thống gửi điểm.");
        }
    }

    function restart() {
        retries++; current = 0; score = 0;
        show('quiz-screen'); render();
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>